# ASIC Pool Switcher + ComEd Pricing Automation

![Python Version](https://img.shields.io/badge/python-%3E%3D3.8-blue) ![License](https://img.shields.io/badge/license-MIT-green)

A **Selenium-based** automation tool to switch ASIC miners (Antminer S19j Pro, Whatsminer M31S+) between solo‚Äë and pool‚Äëmining modes based on **ComEd electricity pricing**, with optional **reboots** and **Telegram** notifications.

---

## üì¶ Features

- **ComEd 5‚ÄëMinute Feed** check: evaluates the previous night‚Äôs (10 PM‚Äì6 AM) prices to decide on solo mining.
- **Dynamic Scheduling**: uses APScheduler to schedule pricing-based and static cron jobs.
- **Configurable** via `config.yaml` for pricing thresholds, time windows, maximum solo block length, cron schedules, and Telegram settings.
- **Telegram Alerts**: sends messages when switching to/from solo mining.
- **On‚ÄëDemand CLI**: switch pools or reboot miners immediately.

## ‚öôÔ∏è Requirements

- Python 3.8+
- Google Chrome (for Selenium)
- ChromeDriver matching your Chrome version

### Python Dependencies

```bash
pip install -r requirements.txt
```

*requirements.txt* should include:

```text
selenium
requests
PyYAML
apscheduler
```

## üìù Configuration (`config.yaml`)

```yaml
timezone: "America/Chicago"

miners:
  - name: ant01
    type: antminer
    ip: 192.168.1.101
    pools:
      solo:
        url: stratum+tcp://127.0.0.1:3333
        worker: ant01
      pool:
        url: stratum+tcp://pool.example.com:3333
        worker: ant01
  - name: msn01
    type: whatsminer
    ip: 192.168.1.102
    pools:
      solo:
        url: stratum+tcp://127.0.0.1:3333
        worker: msn01
      pool:
        url: stratum+tcp://pool.example.com:3333
        worker: msn01

schedule:
  # existing static cron jobs (if any)
  - cron: "0 */6 * * *"
    pool_key: pool

pricing:
  current_api: "https://hourlypricing.comed.com/api?type=currenthouraverage"
  feed_api:    "https://hourlypricing.comed.com/api?type=5minutefeed"
  threshold:   0.02          # $/kWh
  window_start: 22           # 10 PM local (start of low‚Äêprice window)
  window_end:   6            # 6 AM local (end of low‚Äêprice window yesterday)
  max_solo_hours: 6          # maximum solo block
  switch_back_hour: 5        # switch back to pool at 5 AM

telegram:
  bot_token: "<YOUR_BOT_TOKEN>"
  chat_id:   "<YOUR_CHAT_ID>"
```

## üöÄ Usage

### 1. On‚ÄëDemand Operations

```bash
# Switch all miners to solo:
python pool_switcher.py --config config.yaml --pool solo

# Reboot a single miner after switching:
python pool_switcher.py --config config.yaml --pool solo --miner ant01 --reboot
```

### 2. Scheduled Mode

Simply run without flags to start the scheduler:

```bash
python pool_switcher.py --config config.yaml
```

This will:

1. Schedule any **static** cron jobs defined under `schedule`.
2. At **10 PM daily**, evaluate the previous night‚Äôs pricing feed; if under threshold, switch to solo and schedule a switch back after `max_solo_hours`.
3. At **5 AM daily**, force switch back to pool.

## üõ†Ô∏è How It Works

1. **Fetch 5‚ÄëMinute Feed**: pulls the last 24‚ÄØh of pricing data.
2. **Evaluate Window**: checks if all prices between `window_start` and `window_end` yesterday were below `threshold`.
3. **Trigger Solo**: if conditions met, applies the `solo` pool to each miner, then schedules a dynamic job to revert after `max_solo_hours`.
4. **Force Pool**: at `switch_back_hour`, switches all miners back to the `pool` preset.
5. **Alerts**: sends Telegram messages on each switch.

## üìÑ License

This project is licensed under the **MIT License**. See [LICENSE](LICENSE) for details.

---

*Generated by your friendly Pod mining automation suite.*